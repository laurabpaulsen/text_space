"""
Plot embeddings in 3D using plotly. Loads data generated by src/preprocess_data.py
"""

from pathlib import Path
import plotly.express as px
import pandas as pd
import argparse

def parse_args():
    parser = argparse.ArgumentParser()
    parser.add_argument("--csv_file", type = str, default="plotly_data.csv")

    return parser.parse_args()


def plot_embeddings_3d(data, savepath = None):

    # plotly
    fig = px.scatter_3d(data, x='x', y='y', z='z', 
                        color='author', hover_name='author', 
                        hover_data=['text'], text='title',
                        size_max=10, opacity=0.7)

    fig.update_traces(textposition='top center', 
                      hovertemplate='Title: %{text}<br>' +
                                    'Lyrics: %{customdata[0]}<br>'
                      )
    
    fig.update_layout(
        height=800,
        title_text='TextSpace',
        font_family="serif",
        font_size=18,
        title_font_family="serif",
        title_font_size=30,
        legend_title_font_size=20,
        legend_font_size=16,
        scene = dict(
            xaxis_title='x',
            yaxis_title='y',
            zaxis_title='z',
        ),
        margin=dict(l=0, r=0, b=0, t=0)
    )
    

    if savepath: 
        # save html
        fig.write_html(savepath)


def main():
    path = Path(__file__)
    args = parse_args()

    # load data
    data = pd.read_csv(path.parents[1] / "data" / args.csv_file)

    # plot embeddings in 3D
    plot_embeddings_3d(data, savepath = path.parents[1] / "fig" / "embeddings_3d.html")


if __name__ == "__main__":
    main()
